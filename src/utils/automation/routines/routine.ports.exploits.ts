import { NS } from "@ns";
import { availablePortExploits, portExploits } from "/utils/server.hack";


var lastNumberExploits = 0;
export function portExploitsRoutine(ns: NS) {
    // TODO Automatic buy exploits
    printAvailableExploits(ns);
    const numberOfAvailableExploits = availablePortExploits(ns).length;
    var newExploits = lastNumberExploits != numberOfAvailableExploits;
    lastNumberExploits = numberOfAvailableExploits;
    return newExploits
}

var notifiedExploits = new Set<string>()
function printAvailableExploits(ns: NS) {
    if (!ns.hasTorRouter()) {
        return
    }
    var exploitsToPurchase = portExploits
        .filter(([name, ,]) => !ns.fileExists(name, "home"))
        .filter(([, cost,]) => ns.getServerMoneyAvailable("home") > cost)
        .filter(([name, ,]) => !notifiedExploits.has(name))

    if (exploitsToPurchase.length == 0) {
        return
    }

    exploitsToPurchase
        .forEach(([name, ,]) => notifiedExploits.add(name));

    var command = exploitsToPurchase
        .reduce((command, [name, ,]) => `${command} buy ${name};`, ">");

    ns.tprint(`WARN: Execute ${command}`);
}